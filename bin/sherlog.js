#!/usr/bin/env node --nouse-idle-notification --expose-gc --max-old-space-size=8192
!function(e){var t={};function r(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)r.d(n,o,function(t){return e[t]}.bind(null,o));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=25)}([function(e,t){e.exports=require("lodash")},function(e,t){e.exports=require("chalk")},function(e,t){e.exports=require("fs")},function(e,t){e.exports=require("commander")},function(e,t){e.exports=require("os")},function(e,t){e.exports=require("moment-timezone")},function(e,t){e.exports=require("path")},function(e,t){e.exports=require("body-parser")},function(e,t){e.exports=require("express")},function(e,t){e.exports=require("ws")},function(e,t){e.exports=require("events")},function(e,t){e.exports=require("portfinder")},function(e,t){e.exports=require("cors")},function(e,t){e.exports=require("helmet")},function(e,t){e.exports=require("compression")},function(e){e.exports=JSON.parse('{"hostname":"","files":[{"metric":"","file":"","timezone":""}]}')},function(e,t){e.exports=require("http")},function(e,t){e.exports=require("ajv")},function(e,t){e.exports=require("open")},function(e,t){e.exports=require("pako")},function(e,t){e.exports=require("stream")},function(e,t){e.exports=require("internal-ip")},function(e,t){e.exports=require("console-clear")},function(e,t,r){var n,o,i,c,u=function(e,t){if(!(e instanceof t))throw new Error("Bound instance method accessed before binding")};o=r(10),i=r(2),c=r(6),n=class e extends o.EventEmitter{readBlock(){var t,r;if(u(this,e),this.queue.length>=1&&(t=this.queue[0]).end>t.start)return(r=i.createReadStream(this.filename,{start:t.start,end:t.end-1,encoding:this.encoding})).on("error",e=>(this.logger&&this.logger.error("Tail error: ".concat(e)),this.emit("error",e))),r.on("end",()=>{if(this.emit("line","<<EOF>>"),this.queue.shift(),this.queue.length>0&&this.internalDispatcher.emit("next"),this.flushAtEOF&&this.buffer.length>0)return this.emit("line",this.buffer),this.buffer=""}),r.on("data",e=>{var t,r,n,o,i;if(null===this.separator)return this.emit("line",e);for(this.buffer+=e,o=this.buffer.split(this.separator),this.buffer=o.pop(),i=[],r=0,n=o.length;r<n;r++)t=o[r],i.push(this.emit("line",t));return i})}constructor(e){var t,r,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(super(e,n),this.readBlock=this.readBlock.bind(this),this.change=this.change.bind(this),this.filename=e,this.absPath=c.dirname(this.filename),({separator:this.separator=/[\r]{0,1}\n/,fsWatchOptions:this.fsWatchOptions={},follow:this.follow=!0,logger:this.logger,useWatchFile:this.useWatchFile=!1,flushAtEOF:this.flushAtEOF=!1,encoding:this.encoding="utf-8",fromBeginning:r=!1}=n),this.logger){this.logger.info("Tail starting..."),this.logger.info("filename: ".concat(this.filename)),this.logger.info("encoding: ".concat(this.encoding));try{i.accessSync(this.filename,i.constants.F_OK)}catch(e){if("ENOENT"===(t=e).code)throw t}}this.buffer="",this.internalDispatcher=new o.EventEmitter,this.queue=[],this.isWatching=!1,this.internalDispatcher.on("next",()=>this.readBlock()),this.watch(r)}change(t){var r,n;u(this,e);try{n=i.statSync(t)}catch(e){return r=e,this.logger&&this.logger.error("change event for ".concat(t," failed: ").concat(r)),void this.emit("error","change event for ".concat(t," failed: ").concat(r))}if(n.size<this.pos&&(this.pos=n.size),n.size>this.pos&&(this.queue.push({start:this.pos,end:n.size}),this.pos=n.size,1===this.queue.length))return this.internalDispatcher.emit("next")}watch(e){var t,r;if(!this.isWatching){this.logger&&(this.logger.info("filesystem.watch present? ".concat(void 0!==i.watch)),this.logger.info("useWatchFile: ".concat(this.useWatchFile)),this.logger.info("fromBeginning: ".concat(e))),this.isWatching=!0;try{r=i.statSync(this.filename)}catch(e){return t=e,this.logger&&this.logger.error("watch for ".concat(this.filename," failed: ").concat(t)),void this.emit("error","watch for ".concat(this.filename," failed: ").concat(t))}return this.pos=e?0:r.size,0===this.pos&&this.change(this.filename),!this.useWatchFile&&i.watch?(this.logger&&this.logger.info("watch strategy: watch"),this.watcher=i.watch(this.filename,this.fsWatchOptions,(e,t)=>this.watchEvent(e,t))):(this.logger&&this.logger.info("watch strategy: watchFile"),i.watchFile(this.filename,this.fsWatchOptions,(e,t)=>this.watchFileEvent(e,t)))}}rename(e){if(void 0===e||e!==this.filename)return this.unwatch(),this.follow?(this.filename=c.join(this.absPath,e),this.rewatchId=setTimeout(()=>this.watch(),1e3)):(this.logger&&this.logger.error("'rename' event for ".concat(this.filename,". File not available.")),this.emit("error","'rename' event for ".concat(this.filename,". File not available.")))}watchEvent(e,t){return"change"===e?this.change(this.filename):"rename"===e?this.rename(t):void 0}watchFileEvent(e,t){if(e.size>t.size&&(this.pos=e.size,this.queue.push({start:t.size,end:e.size}),1===this.queue.length))return this.internalDispatcher.emit("next")}unwatch(){if(this.watcher?this.watcher.close():i.unwatchFile(this.filename),this.rewatchId&&(clearTimeout(this.rewatchId),this.rewatchId=void 0),this.isWatching=!1,this.queue=[],this.logger)return this.logger.info("Unwatch ",this.filename)}},t.Tail=n},function(e){e.exports=JSON.parse('{"name":"sherlog-cli","version":"0.0.1","main":"bin/sherlog.js","os":["!win32"],"engines":{"node":">=0.12"},"engineStrict":true,"scripts":{"dev":"webpack --env.NODE_ENV=dev --config webpack.dev.js","build":"NODE_ENV=production webpack --progress --hide-modules --config webpack.prod.js && chmod +x bin/sherlog.js","lint":"eslint --ignore-path .eslintignore .","lint:fix":"eslint --ignore-path .eslintignore --fix src","docker:build":"docker build -t sherlog/cli .","docker:test":"npm run build && npm run docker:build && docker run sherlog/cli","test":"tests/run.sh","cli:test":"bats tests/cli","integration:test":"jest --config=jest.config.js tests/Integration"},"bin":{"slg":"bin/sherlog.js","slog":"bin/sherlog.js","sherlog":"bin/sherlog.js"},"dependencies":{"ajv":"^6.12.4","body-parser":"^1.19.0","chalk":"^4.1.0","commander":"^6.0.0","compression":"^1.7.4","console-clear":"^1.1.1","cors":"^2.8.5","express":"^4.17.1","helmet":"^3.23.3","internal-ip":"^6.1.0","lodash":"^4.17.20","moment-timezone":"^0.5.31","open":"^7.1.0","pako":"^1.0.11","portfinder":"^1.0.28","shebang-loader":"0.0.1","tail":"^2.0.4","ws":"^7.3.1"},"devDependencies":{"@babel/cli":"^7.8.4","@babel/core":"^7.9.6","@babel/node":"^7.10.1","@babel/preset-env":"^7.9.6","babel-loader":"^8.1.0","babel-plugin-module-resolver":"^4.0.0","bats":"^1.1.0","clean-webpack-plugin":"^3.0.0","copy-webpack-plugin":"^6.0.2","eslint":"^7.7.0","eslint-config-airbnb-base":"^14.2.0","eslint-config-prettier":"^6.11.0","eslint-import-resolver-alias":"^1.1.2","eslint-import-resolver-webpack":"^0.12.2","eslint-plugin-import":"^2.22.0","eslint-plugin-jest":"^23.20.0","file-loader":"^6.0.0","jest":"^26.4.2","nodemon-webpack-plugin":"^4.3.1","prettier":"^2.0.5","replace":"^1.2.0","webpack":"^4.43.0","webpack-cli":"^3.3.11","webpack-merge":"^4.2.2","webpack-node-externals":"^1.7.2"},"optionalDependencies":{"bufferutil":"^4.0.1","utf-8-validate":"^5.0.2"}}')},function(e,t,r){"use strict";r.r(t);var n=r(2),o=r.n(n),i=r(6),c=r.n(i),u=r(0),a=r(11),s=r.n(a),l=r(7),p=r.n(l),f=r(12),h=r.n(f),y=r(13),b=r.n(y),g=r(14),m=r.n(g),O=r(15),d=r(8),v=r.n(d),w=r(9),j=r.n(w),x=r(16),P=r.n(x),F=r(4),S=r.n(F),E=r(3),D=r.n(E),_=r(17),k=r.n(_),R=r(5),M=r.n(R),T=r(18),q=r.n(T),Y=r(1),z=r.n(Y),A=r(19),N=r.n(A),W=r(20),J=r(21),B=r.n(J),$=r(22),H=r.n($),Z=r(23);class I{constructor(e){var{dateFormat:t,hostname:r,payload:n,metric:o,regex:i,eventType:c,timezone:u}=e;this.dateFormat=t,this.hostname=r,this.payload=n,this.metric=o,this.regex=i,this.eventType=c,this.timezone=u,this.buffer=[]}tag(e,t){return{metric:this.metric,tags:{hostname:this.hostname,type:this.eventType,platform:S.a.platform()},timestamp:Number(t),values:e}}format(e){var t=[];return e.forEach(e=>{var r=M.a.tz(e.datetime,this.dateFormat,this.timezone).clone().tz("UTC");t.push(Object(u.assignIn)(e,{datetime:r.format(),timestamp:Number(r.format("X"))}))}),Object(u.map)(Object(u.groupBy)(t,"timestamp"),(e,t)=>this.tag(e,t))}dispatch(e,t){var r=[...Object(u.take)(this.buffer,e).join("\n").matchAll(this.regex)];r.length&&t(this.format(Object(u.map)(r,"groups"))),this.buffer.splice(0,e)}onBuffer(e,t){if(this.buffer.length===this.payload||"<<EOF>>"===e){var r=this.buffer.length;this.dispatch(r,t)}this.buffer.push(e)}}function L(e,t){L=function(e,t){return new i(e,void 0,t)};var r=V(RegExp),n=RegExp.prototype,o=new WeakMap;function i(e,t,n){var i=r.call(this,e,t);return o.set(i,n||o.get(e)),i}function c(e,t){var r=o.get(t);return Object.keys(r).reduce((function(t,n){return t[n]=e[r[n]],t}),Object.create(null))}return U(i,r),i.prototype.exec=function(e){var t=n.exec.call(this,e);return t&&(t.groups=c(t,this)),t},i.prototype[Symbol.replace]=function(e,t){if("string"==typeof t){var r=o.get(this);return n[Symbol.replace].call(this,e,t.replace(/\$<([^>]+)>/g,(function(e,t){return"$"+r[t]})))}if("function"==typeof t){var i=this;return n[Symbol.replace].call(this,e,(function(){var e=[];return e.push.apply(e,arguments),"object"!=typeof e[e.length-1]&&e.push(c(e,i)),t.apply(this,e)}))}return n[Symbol.replace].call(this,e,t)},L.apply(this,arguments)}function U(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&X(e,t)}function V(e){var t="function"==typeof Map?new Map:void 0;return(V=function(e){if(null===e||(r=e,-1===Function.toString.call(r).indexOf("[native code]")))return e;var r;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,n)}function n(){return K(e,arguments,G(this).constructor)}return n.prototype=Object.create(e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),X(n,e)})(e)}function K(e,t,r){return(K=C()?Reflect.construct:function(e,t,r){var n=[null];n.push.apply(n,t);var o=new(Function.bind.apply(e,n));return r&&X(o,r.prototype),o}).apply(null,arguments)}function C(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function X(e,t){return(X=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function G(e){return(G=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Q(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function ee(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Q(Object(r),!0).forEach((function(t){te(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Q(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function te(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class re extends I{constructor(e){super(ee(ee({},e),{},{dateFormat:"DD/MMM/YYYY:HH:mm:ss ZZ",regex:L(/^([\0-\x08\x0E-\x1F!-\x9F\xA1-\u167F\u1681-\u1FFF\u200B-\u2027\u202A-\u202E\u2030-\u205E\u2060-\u2FFF\u3001-\uFEFE\uFF00-\uFFFF]+) [\0-\x08\x0E-\x1F!-\x9F\xA1-\u167F\u1681-\u1FFF\u200B-\u2027\u202A-\u202E\u2030-\u205E\u2060-\u2FFF\u3001-\uFEFE\uFF00-\uFFFF]+ .*\[([0-9]{2}\/(Jan(uary)?|Feb(ruary)?|Mar(ch)?|Apr(il)?|May|Jun(e)?|Jul(y)?|Aug(ust)?|Sep(tember)?|Oct(ober)?|Nov(ember)?|Dec(ember)?)\/[0-9]{4}:[0-9]{2}:[0-9]{2}:[0-9]{2} [\+\x2D\|][0-9]{4})\] (.*)/gm,{client:1,datetime:2,message:15})}))}}function ne(e,t){ne=function(e,t){return new i(e,void 0,t)};var r=ie(RegExp),n=RegExp.prototype,o=new WeakMap;function i(e,t,n){var i=r.call(this,e,t);return o.set(i,n||o.get(e)),i}function c(e,t){var r=o.get(t);return Object.keys(r).reduce((function(t,n){return t[n]=e[r[n]],t}),Object.create(null))}return oe(i,r),i.prototype.exec=function(e){var t=n.exec.call(this,e);return t&&(t.groups=c(t,this)),t},i.prototype[Symbol.replace]=function(e,t){if("string"==typeof t){var r=o.get(this);return n[Symbol.replace].call(this,e,t.replace(/\$<([^>]+)>/g,(function(e,t){return"$"+r[t]})))}if("function"==typeof t){var i=this;return n[Symbol.replace].call(this,e,(function(){var e=[];return e.push.apply(e,arguments),"object"!=typeof e[e.length-1]&&e.push(c(e,i)),t.apply(this,e)}))}return n[Symbol.replace].call(this,e,t)},ne.apply(this,arguments)}function oe(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ae(e,t)}function ie(e){var t="function"==typeof Map?new Map:void 0;return(ie=function(e){if(null===e||(r=e,-1===Function.toString.call(r).indexOf("[native code]")))return e;var r;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,n)}function n(){return ce(e,arguments,se(this).constructor)}return n.prototype=Object.create(e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),ae(n,e)})(e)}function ce(e,t,r){return(ce=ue()?Reflect.construct:function(e,t,r){var n=[null];n.push.apply(n,t);var o=new(Function.bind.apply(e,n));return r&&ae(o,r.prototype),o}).apply(null,arguments)}function ue(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function ae(e,t){return(ae=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function se(e){return(se=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function le(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function pe(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?le(Object(r),!0).forEach((function(t){fe(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):le(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function fe(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class he extends I{constructor(e){super(pe(pe({},e),{},{dateFormat:"ddd MMM DD HH:mm:ss.SSSSSS YYYY",regex:ne(/\[(((Mon|Tue(s)?|Wed(nes)?|Thu(rs|r)?|Fri|Sat(ur)?|Sun)(day)?) (Jan(uary)?|Feb(ruary)?|Mar(ch)?|Apr(il)?|May|Jun(e)?|Jul(y)?|Aug(ust)?|Sep(tember)?|Oct(ober)?|Nov(ember)?|Dec(ember)?) [0-9]{2} [0-9]{2}:[0-9]{2}:[0-9]{2}\.[0-9]{6} [0-9]{4})\] (.*)/gm,{datetime:1,message:21})}))}}function ye(e,t){ye=function(e,t){return new i(e,void 0,t)};var r=ge(RegExp),n=RegExp.prototype,o=new WeakMap;function i(e,t,n){var i=r.call(this,e,t);return o.set(i,n||o.get(e)),i}function c(e,t){var r=o.get(t);return Object.keys(r).reduce((function(t,n){return t[n]=e[r[n]],t}),Object.create(null))}return be(i,r),i.prototype.exec=function(e){var t=n.exec.call(this,e);return t&&(t.groups=c(t,this)),t},i.prototype[Symbol.replace]=function(e,t){if("string"==typeof t){var r=o.get(this);return n[Symbol.replace].call(this,e,t.replace(/\$<([^>]+)>/g,(function(e,t){return"$"+r[t]})))}if("function"==typeof t){var i=this;return n[Symbol.replace].call(this,e,(function(){var e=[];return e.push.apply(e,arguments),"object"!=typeof e[e.length-1]&&e.push(c(e,i)),t.apply(this,e)}))}return n[Symbol.replace].call(this,e,t)},ye.apply(this,arguments)}function be(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&de(e,t)}function ge(e){var t="function"==typeof Map?new Map:void 0;return(ge=function(e){if(null===e||(r=e,-1===Function.toString.call(r).indexOf("[native code]")))return e;var r;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,n)}function n(){return me(e,arguments,ve(this).constructor)}return n.prototype=Object.create(e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),de(n,e)})(e)}function me(e,t,r){return(me=Oe()?Reflect.construct:function(e,t,r){var n=[null];n.push.apply(n,t);var o=new(Function.bind.apply(e,n));return r&&de(o,r.prototype),o}).apply(null,arguments)}function Oe(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function de(e,t){return(de=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function ve(e){return(ve=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function we(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function je(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?we(Object(r),!0).forEach((function(t){xe(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):we(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function xe(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Pe(e,t){Pe=function(e,t){return new i(e,void 0,t)};var r=Se(RegExp),n=RegExp.prototype,o=new WeakMap;function i(e,t,n){var i=r.call(this,e,t);return o.set(i,n||o.get(e)),i}function c(e,t){var r=o.get(t);return Object.keys(r).reduce((function(t,n){return t[n]=e[r[n]],t}),Object.create(null))}return Fe(i,r),i.prototype.exec=function(e){var t=n.exec.call(this,e);return t&&(t.groups=c(t,this)),t},i.prototype[Symbol.replace]=function(e,t){if("string"==typeof t){var r=o.get(this);return n[Symbol.replace].call(this,e,t.replace(/\$<([^>]+)>/g,(function(e,t){return"$"+r[t]})))}if("function"==typeof t){var i=this;return n[Symbol.replace].call(this,e,(function(){var e=[];return e.push.apply(e,arguments),"object"!=typeof e[e.length-1]&&e.push(c(e,i)),t.apply(this,e)}))}return n[Symbol.replace].call(this,e,t)},Pe.apply(this,arguments)}function Fe(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_e(e,t)}function Se(e){var t="function"==typeof Map?new Map:void 0;return(Se=function(e){if(null===e||(r=e,-1===Function.toString.call(r).indexOf("[native code]")))return e;var r;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,n)}function n(){return Ee(e,arguments,ke(this).constructor)}return n.prototype=Object.create(e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),_e(n,e)})(e)}function Ee(e,t,r){return(Ee=De()?Reflect.construct:function(e,t,r){var n=[null];n.push.apply(n,t);var o=new(Function.bind.apply(e,n));return r&&_e(o,r.prototype),o}).apply(null,arguments)}function De(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function _e(e,t){return(_e=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function ke(e){return(ke=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Re(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Me(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Re(Object(r),!0).forEach((function(t){Te(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Re(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function Te(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class qe extends I{constructor(e){super(Me(Me({},e),{},{dateFormat:"YYYY-MM-DDTHH:mm:ss.SSSSSS[Z]",regex:Pe(/^([0-9]{4}\x2D[0-9]{2}\x2D[0-9]{2}T[0-9]{2}:[0-9]{2}:[0-9]{2}\.[0-9]{6}Z) (.*)/gm,{datetime:1,message:2})}))}}function Ye(e,t){Ye=function(e,t){return new i(e,void 0,t)};var r=Ae(RegExp),n=RegExp.prototype,o=new WeakMap;function i(e,t,n){var i=r.call(this,e,t);return o.set(i,n||o.get(e)),i}function c(e,t){var r=o.get(t);return Object.keys(r).reduce((function(t,n){return t[n]=e[r[n]],t}),Object.create(null))}return ze(i,r),i.prototype.exec=function(e){var t=n.exec.call(this,e);return t&&(t.groups=c(t,this)),t},i.prototype[Symbol.replace]=function(e,t){if("string"==typeof t){var r=o.get(this);return n[Symbol.replace].call(this,e,t.replace(/\$<([^>]+)>/g,(function(e,t){return"$"+r[t]})))}if("function"==typeof t){var i=this;return n[Symbol.replace].call(this,e,(function(){var e=[];return e.push.apply(e,arguments),"object"!=typeof e[e.length-1]&&e.push(c(e,i)),t.apply(this,e)}))}return n[Symbol.replace].call(this,e,t)},Ye.apply(this,arguments)}function ze(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Je(e,t)}function Ae(e){var t="function"==typeof Map?new Map:void 0;return(Ae=function(e){if(null===e||(r=e,-1===Function.toString.call(r).indexOf("[native code]")))return e;var r;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,n)}function n(){return Ne(e,arguments,Be(this).constructor)}return n.prototype=Object.create(e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),Je(n,e)})(e)}function Ne(e,t,r){return(Ne=We()?Reflect.construct:function(e,t,r){var n=[null];n.push.apply(n,t);var o=new(Function.bind.apply(e,n));return r&&Je(o,r.prototype),o}).apply(null,arguments)}function We(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function Je(e,t){return(Je=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Be(e){return(Be=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function $e(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function He(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?$e(Object(r),!0).forEach((function(t){Ze(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):$e(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function Ze(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class Ie extends I{constructor(e){super(He(He({},e),{},{dateFormat:"DD/MMM/YYYY:HH:mm:ss ZZ",regex:Ye(/^([\0-\x08\x0E-\x1F!-\x9F\xA1-\u167F\u1681-\u1FFF\u200B-\u2027\u202A-\u202E\u2030-\u205E\u2060-\u2FFF\u3001-\uFEFE\uFF00-\uFFFF]+) [\0-\x08\x0E-\x1F!-\x9F\xA1-\u167F\u1681-\u1FFF\u200B-\u2027\u202A-\u202E\u2030-\u205E\u2060-\u2FFF\u3001-\uFEFE\uFF00-\uFFFF]+ .*\[([0-9]{2}\/(Jan(uary)?|Feb(ruary)?|Mar(ch)?|Apr(il)?|May|Jun(e)?|Jul(y)?|Aug(ust)?|Sep(tember)?|Oct(ober)?|Nov(ember)?|Dec(ember)?)\/[0-9]{4}:[0-9]{2}:[0-9]{2}:[0-9]{2} [\+\x2D\|][0-9]{4})\] (.*)/gm,{client:1,datetime:2,message:15})}))}}function Le(e,t){Le=function(e,t){return new i(e,void 0,t)};var r=Ve(RegExp),n=RegExp.prototype,o=new WeakMap;function i(e,t,n){var i=r.call(this,e,t);return o.set(i,n||o.get(e)),i}function c(e,t){var r=o.get(t);return Object.keys(r).reduce((function(t,n){return t[n]=e[r[n]],t}),Object.create(null))}return Ue(i,r),i.prototype.exec=function(e){var t=n.exec.call(this,e);return t&&(t.groups=c(t,this)),t},i.prototype[Symbol.replace]=function(e,t){if("string"==typeof t){var r=o.get(this);return n[Symbol.replace].call(this,e,t.replace(/\$<([^>]+)>/g,(function(e,t){return"$"+r[t]})))}if("function"==typeof t){var i=this;return n[Symbol.replace].call(this,e,(function(){var e=[];return e.push.apply(e,arguments),"object"!=typeof e[e.length-1]&&e.push(c(e,i)),t.apply(this,e)}))}return n[Symbol.replace].call(this,e,t)},Le.apply(this,arguments)}function Ue(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Xe(e,t)}function Ve(e){var t="function"==typeof Map?new Map:void 0;return(Ve=function(e){if(null===e||(r=e,-1===Function.toString.call(r).indexOf("[native code]")))return e;var r;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,n)}function n(){return Ke(e,arguments,Ge(this).constructor)}return n.prototype=Object.create(e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),Xe(n,e)})(e)}function Ke(e,t,r){return(Ke=Ce()?Reflect.construct:function(e,t,r){var n=[null];n.push.apply(n,t);var o=new(Function.bind.apply(e,n));return r&&Xe(o,r.prototype),o}).apply(null,arguments)}function Ce(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function Xe(e,t){return(Xe=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Ge(e){return(Ge=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Qe(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function et(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Qe(Object(r),!0).forEach((function(t){tt(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Qe(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function tt(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class rt extends I{constructor(e){super(et(et({},e),{},{dateFormat:"YYYY/MM/DD HH:mm:ss",regex:Le(/^([0-9]{4}\/[0-9]{2}\/[0-9]{2} [0-9]{2}:[0-9]{2}:[0-9]{2}) \[([0-9A-Z_a-z]+)\] ([0-9]+).([0-9]+): (.*)/gm,{datetime:1,log_level:2,pid:3,tid:4,message:5})}))}}function nt(e,t){nt=function(e,t){return new i(e,void 0,t)};var r=it(RegExp),n=RegExp.prototype,o=new WeakMap;function i(e,t,n){var i=r.call(this,e,t);return o.set(i,n||o.get(e)),i}function c(e,t){var r=o.get(t);return Object.keys(r).reduce((function(t,n){return t[n]=e[r[n]],t}),Object.create(null))}return ot(i,r),i.prototype.exec=function(e){var t=n.exec.call(this,e);return t&&(t.groups=c(t,this)),t},i.prototype[Symbol.replace]=function(e,t){if("string"==typeof t){var r=o.get(this);return n[Symbol.replace].call(this,e,t.replace(/\$<([^>]+)>/g,(function(e,t){return"$"+r[t]})))}if("function"==typeof t){var i=this;return n[Symbol.replace].call(this,e,(function(){var e=[];return e.push.apply(e,arguments),"object"!=typeof e[e.length-1]&&e.push(c(e,i)),t.apply(this,e)}))}return n[Symbol.replace].call(this,e,t)},nt.apply(this,arguments)}function ot(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&at(e,t)}function it(e){var t="function"==typeof Map?new Map:void 0;return(it=function(e){if(null===e||(r=e,-1===Function.toString.call(r).indexOf("[native code]")))return e;var r;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,n)}function n(){return ct(e,arguments,st(this).constructor)}return n.prototype=Object.create(e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),at(n,e)})(e)}function ct(e,t,r){return(ct=ut()?Reflect.construct:function(e,t,r){var n=[null];n.push.apply(n,t);var o=new(Function.bind.apply(e,n));return r&&at(o,r.prototype),o}).apply(null,arguments)}function ut(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function at(e,t){return(at=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function st(e){return(st=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function lt(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function pt(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?lt(Object(r),!0).forEach((function(t){ft(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):lt(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function ft(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function ht(e,t){ht=function(e,t){return new i(e,void 0,t)};var r=bt(RegExp),n=RegExp.prototype,o=new WeakMap;function i(e,t,n){var i=r.call(this,e,t);return o.set(i,n||o.get(e)),i}function c(e,t){var r=o.get(t);return Object.keys(r).reduce((function(t,n){return t[n]=e[r[n]],t}),Object.create(null))}return yt(i,r),i.prototype.exec=function(e){var t=n.exec.call(this,e);return t&&(t.groups=c(t,this)),t},i.prototype[Symbol.replace]=function(e,t){if("string"==typeof t){var r=o.get(this);return n[Symbol.replace].call(this,e,t.replace(/\$<([^>]+)>/g,(function(e,t){return"$"+r[t]})))}if("function"==typeof t){var i=this;return n[Symbol.replace].call(this,e,(function(){var e=[];return e.push.apply(e,arguments),"object"!=typeof e[e.length-1]&&e.push(c(e,i)),t.apply(this,e)}))}return n[Symbol.replace].call(this,e,t)},ht.apply(this,arguments)}function yt(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ot(e,t)}function bt(e){var t="function"==typeof Map?new Map:void 0;return(bt=function(e){if(null===e||(r=e,-1===Function.toString.call(r).indexOf("[native code]")))return e;var r;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,n)}function n(){return gt(e,arguments,dt(this).constructor)}return n.prototype=Object.create(e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),Ot(n,e)})(e)}function gt(e,t,r){return(gt=mt()?Reflect.construct:function(e,t,r){var n=[null];n.push.apply(n,t);var o=new(Function.bind.apply(e,n));return r&&Ot(o,r.prototype),o}).apply(null,arguments)}function mt(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function Ot(e,t){return(Ot=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function dt(e){return(dt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function vt(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function wt(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?vt(Object(r),!0).forEach((function(t){jt(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):vt(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function jt(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var xt={apache2:class{constructor(e){var{eventType:t}=e;return"http"===t?new re(e):new he(e)}},monolog:class extends I{constructor(e){super(je(je({},e),{},{dateFormat:"YYYY-MM-DD HH:mm:ss",regex:ye(/^\[(.*)\] (.+?)\.([A-Z]+): ((?:[\0-\t\x0B-\uFFFF][\n ]?)+)$/gm,{datetime:1,channel:2,severity:3,message:4})}))}},mysql:class{constructor(e){var{eventType:t}=e;if("error"===t)return new qe(e)}},nginx:class{constructor(e){var{eventType:t}=e;return"http"===t?new Ie(e):new rt(e)}},phpfpm:class extends I{constructor(e){super(pt(pt({},e),{},{dateFormat:"DD-MMM-YYYY HH:mm:ss",regex:nt(/\[([\0-\\\^-\uFFFF]+)\].* ([A-Z]+:) (.*)/gm,{datetime:1,log_level:2,message:3})}))}},redis:class extends I{constructor(e){super(wt(wt({},e),{},{dateFormat:"DD MMM YYYY HH:mm:ss.SSS",regex:ht(/^([0-9]+:[A-Z]) ([0-9]{2} (Jan(uary)?|Feb(ruary)?|Mar(ch)?|Apr(il)?|May|Jun(e)?|Jul(y)?|Aug(ust)?|Sep(tember)?|Oct(ober)?|Nov(ember)?|Dec(ember)?) [0-9]{4} [0-9]{2}:[0-9]{2}:[0-9]{2}\.[0-9]{3}) (.*)/gm,{pid:1,datetime:2,message:15})}))}}},Pt=r(10);class Ft extends Pt{constructor(e){super();var{hostname:t,files:r,chunks:n}=e;this.watcher=[],this.buffer=[],this.count=0;var o=Number(n)||1;this.config=r.forEach(e=>{var{metric:r,file:n,eventType:i,timezone:c,dateFormat:u,regex:a,fromBeginning:s}=e;if(Object.keys(xt).includes(r)){var l=new xt[r]({hostname:t,payload:o,metric:r,eventType:i,timezone:c,dateFormat:u,regex:a}),p=new Z.Tail(n,{flushAtEOF:!0,fromBeginning:s});p.on("line",e=>{l.onBuffer(e,this.read.bind(this))}),p.on("error",e=>{this.emit("error",e)}),this.watcher.push(p)}})}read(e){e.forEach(e=>{this.count+=e.values.length}),console.log(this.count),this.emit("buffer",e)}unwatch(){return new Promise((e,t)=>{try{this.watcher.forEach((e,t)=>{e.unwatch(),this.watcher.splice(t,1)}),e()}catch(e){t(e)}})}}var St=r(24);function Et(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Dt(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _t(e,t,r,n,o,i,c){try{var u=e[i](c),a=u.value}catch(e){return void r(e)}u.done?t(a):Promise.resolve(a).then(n,o)}function kt(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var i=e.apply(t,r);function c(e){_t(i,n,o,c,u,"next",e)}function u(e){_t(i,n,o,c,u,"throw",e)}c(void 0)}))}}var Rt=new W.Readable({highWaterMark:1e5,objectMode:!0,encoding:"utf8"});Rt._read=()=>{};var Mt=e=>{process.on("warning",e=>{console.warn(e.stack),process.exit(1)});var t=v()(),r=P.a.createServer(t);t.use(b()()),t.use(h()()),t.use(m()()),t.use(p.a.json()),t.use(p.a.urlencoded({extended:!1}));var n=c.a.normalize("".concat(process.execPath,"/../../lib/node_modules/sherlog-cli/public"));o.a.existsSync(n)||(console.log("Unable to locate your global node_modules path"),process.exit(1)),t.use(v.a.static(n)),t.get("/ready",(e,t)=>{t.send("UP")}),t.use((e,t,r,n)=>{console.error(e.stack),n(e)}),s.a.getPortPromise().then(t=>{var n=e.port||t;r.listen(n,kt((function*(){var t=new j.a.Server({server:r}),o=Number(e.backpressure)||1e3;H()(!0);var i="http://localhost:".concat(n);console.log("   - Dashboard:   ".concat(z.a.green(i))),console.log("\n"),console.log("Sherlog listening on:"),console.log("\n"),console.log("   - Local:   ".concat(z.a.green("ws://localhost:".concat(n)))),console.log("   - Network:   ".concat(z.a.green("ws://".concat(yield B.a.v4(),":").concat(n))));var c=new Ft(e);c.on("buffer",t=>{Rt.push(((e,t)=>t?N.a.deflate(JSON.stringify(e),{to:"string"}):JSON.stringify(e))(t,Boolean(e.compression)))});var a=Object(u.debounce)(()=>{if(Object(u.size)(t.clients)){var e=Rt.read();e&&t.clients.forEach(t=>{t.readyState===j.a.OPEN&&t.send(e)}),Rt.pause(),a()}},o,{maxWait:2e3});Rt.on("readable",a),c.on("error",e=>{console.error("ERROR: ",e)}),t.on("connection",kt((function*(){console.log("connection"),Rt.emit("readable")}))),setTimeout(kt((function*(){e.browser&&(yield q()(i))})),500)})))})},Tt=o.a.existsSync("".concat(process.cwd(),"/").concat(".sherlog")),qt=JSON.stringify(Object(u.assign)(O,{hostname:S.a.hostname()}),null,2),Yt=e=>{e.config&&!o.a.existsSync(e.config)&&(console.log("invalid config file path ".concat(z.a.yellow(e.config))),process.exit(1)),Tt||e.config||(console.log("".concat(z.a.yellow(".sherlog")," not found. run the init command to initialize the current working directory")),process.exit(1));var t=o.a.readFileSync(e.config||".sherlog","utf8");(e=>{try{return JSON.parse(e),!0}catch(e){return!1}})(t)||(console.log("your config file has an invalid JSON syntax"),process.exit(1));var r,n,i,c,a=(r=JSON.parse(t),n=new k.a({allErrors:!0}),i={type:"object",properties:{hostname:{type:"string",minimum:1},backpressure:{type:"number",minimum:0},chunks:{type:"number",minimum:1},env:{type:"string",minLength:1},compression:{type:"boolean",enum:[!0,!1]},files:{type:"array",uniqueItems:!0,minItems:1,maxItems:50,items:{type:"object",properties:{metric:{type:"string",enum:["apache2","nginx","phpfpm","monolog","mysql","redis"]},eventType:{type:"string",enum:["http","error"]},fromBeginning:{type:"boolean",enum:[!0,!1]},file:{type:"string",minLength:1},timezone:{type:"string",enum:M.a.tz.names()}},required:["metric","file","timezone"],if:{properties:{metric:{enum:["apache2","nginx","mysql"]}}},then:{required:["eventType"]}}}},required:["hostname","files"]},(c=n.compile(i))(r)?[]:c.errors);Object(u.isEmpty)(a)||(console.log((e=>Object(u.compact)(Object(u.map)(e,e=>{if("if"!==e.keyword)return"".concat(z.a.red("->")," ").concat(e.dataPath," ").concat(e.message," ").concat(Object(u.get)(e,"params.allowedValues",""))})))(a).join(S.a.EOL)),process.exit(1))};D.a.command("init").option("-f, --force","force to overwrite ".concat(".sherlog")).description("initializes the project").action(e=>{!Tt||Tt&&e.force?(console.log("creating ".concat(z.a.green(".sherlog"))),o.a.writeFileSync(".sherlog",qt),process.exit(0)):(console.log("pass the --force option to overwrite your existing ".concat(z.a.green(".sherlog")," config file")),process.exit(1))}),D.a.command("test").description("validate your config schema").option("-c, --config <path>","path to config file").action(e=>{Yt(e),console.log("your ".concat(z.a.green(e.config||".sherlog")," schema is valid!")),process.exit(0)}),D.a.command("start").description("start the server").option("-c, --config <path>","path to config file").option("-p, --port <port-number>","port number").option("--browser","open browser window").action(e=>{Yt(e);var t=JSON.parse(o.a.readFileSync(e.config||".sherlog","utf8")),r=Object(u.map)(t.files,e=>new Promise((t,r)=>{o.a.access(e.file,o.a.constants.F_OK,n=>{n&&r(n.path),t(e.file)})}));Promise.all(r).then(()=>{Mt(function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Et(Object(r),!0).forEach((function(t){Dt(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Et(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}({browser:Boolean(e.browser),port:e.port},t))}).catch(e=>{console.log("no such file ".concat(z.a.yellow(e))),process.exit(1)})}),D.a.version(St.version,"-v, --version","print version"),D.a.parse(process.argv)}]);